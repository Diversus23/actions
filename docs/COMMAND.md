# Описание команд

| Команда | Описание |
| --- | --- |
| [`autodoc`](#autodoc) | Автоформирование документации по этому проекту CI/CD. Системная команда |
| [`changelog`](#changelog) | Получение информации в формате HTML или TXT для определенной версии из файла CHANGELOG.md |
| [`changelog-init`](#changelog-init) | Инициализация нового файла CHANGELOG.md для проекта |
| [`checkconfig`](#checkconfig) | Выполнить проверку синтаксиса конфигурации 1С встроенными средствами |
| [`checksum`](#checksum) | Выводит в консоль контрольную сумма файла или директории в формате MD5 |
| [`createibfile`](#createibfile) | Создание файловой информационной базы 1C в каталоге |
| [`createibserver`](#createibserver) | Создание серверной информационной базы на сервере 1С |
| [`help`](#help) | Вывод справки по параметрам |
| [`obfuscation`](#obfuscation) | Обфускация (запутывание) кода файла общего модуля на языке 1С |
| [`version`](#version) | Версия приложения |
| [`zip-add`](#zip-add) | Создать zip-архив |
| [`zip-extract`](#zip-extract) | Распаковать zip-архив в директорию |

## autodoc

Автоформирование документации по этому проекту CI/CD. Системная команда.

### Параметры команды

- **-file** Путь к файлу, куда сохранить документацию (обязательный).
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

## changelog

Получение информации в формате HTML или TXT для определенной версии из файла CHANGELOG.md.

### Параметры команды

- **-file** Исходный файл CHANGELOG.md в формате MarkDown из которого необходимо получить описание (обязательный).
- **-outfile** Файл с новостью по обновлению из исходного файла в формате HTML или TXT в зависимости от расширения файла.
Если файл будет оканчиваться на html или htm, то новость сохранится в формате HTML.
Если же расширение будет другим, то новость сохранится в текстовом формате (обязательный).
- **-version** По какой версии будет получено описание обновления.
Если не задано, то будет получено по последней (необязательный).
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

### Что такое лог изменений?

ChangeLog — это файл, который содержит поддерживаемый, хронологически упорядоченный список значимых изменений для каждой версии проекта.

Формат основан на [Keep a Changelog](http://keepachangelog.com/) и этот проект придерживается [Semantic Versioning](http://semver.org/).


### Зачем вести лог изменений?

Чтобы пользователям и контрибуторам было проще в точности понять, какие значимые изменения были внесены в каждый выпуск (или версию) проекта.

### Кому нужен лог изменений?

Людям. Конечные пользователи программного обеспечения, будь то клиенты или разработчики, — это человеческие существа, которым небезразлично, с чем они работают. Когда программное обеспечение изменяется, люди хотят знать, что и почему изменилось.

### Как мне сделать хороший лог изменений?

#### Руководящие принципы

* Лог изменений — для людей, а не для машин.
* Для каждой версии без исключения следует создать отдельный раздел.
* Однотипные изменения следует группировать.
* Следует предусмотреть возможность поставить ссылку на любую версию или раздел.
* Последняя версия должна идти в начале файла.
* Указаны даты выпуска каждой версии.
Уточните, следуете ли вы принципам семантического версионирования.

#### Типы изменений

* `Внимание!` — для чего-то важного, о чем стоит сказать отдельно.
* `Добавлено` — для новых функций.
* `Изменено` — для изменений в существующей функциональности.
* `Устарело` — для функций, которые скоро будут удалены.
* `Удалено` — для удалённых на данный момент функций.
* `Исправлено` — для любых исправлений багов.
* `Безопасность` — на случай уязвимостей.

Обратите внимание, что заголовки можно писать как на русском, так и на английском. Т.е. заголовки ниже взаимозаменяемы и являются синонимами:

* Внимание! и Attention! и Новости и News
* Добавлено и Added и Новый функционал
* Изменено и Changed и Изменения
* Устарело и Deprecated
* Исправление ошибок и Fixed и Замечания к обновлению
* Удалено и Removed
* Безопасность и Security

Т.е. можно написать так:

```markdown
## Изменено

* Изменено следующее 1
```

А можно вот так:

```markdown
## Changed

* Change next 1
```

Доступно полно форматирование markdown внутри заметок. Можно начинать строки с символа "*", а можно с "-".

### Как мне тратить меньше усилий на ведение лога изменений?

Держите в начале файла раздел `Unreleased`, позволяющий отслеживать предстоящие изменения.

Это служит достижению двух целей:

1. Люди смогут видеть, каких изменений им можно ожидать в предстоящих выпусках;
2. В момент релиза вы можете переместить изменения из раздела `Unreleased` в раздел нового выпуска.

### Пример файла CHANGELOG

```markdown
Продукт

# [Unreleased] - yyyy-mm-dd

## Added

* Здесь мы пишем заметки об обновлении которое еще не вышло. Делайте их как можно более простыми.

# [1.0.0.5] - 2023-06-06

## Внимание! (Attention!)

- Важная заметка 1 **жирный** *курсив* __снова жиный__ _снова курсив_
- Важная заметка 2 ~~Зачеркнутый~~

## Добавлено (Added)

- Добавлено дело 1 ***жирный курсив***
- Добавлено дело 2 `выделенный`
- Картинка ![Описание](![Описание](https://github.com/images/modules/search/mona-love.png)
 
## Изменено (Changed)

* Изменено следующее 1
* Изменено следующее 2
 
## Исправление ошибок (Fixed)

* Исправлено следующее 1
* Исправлено следующее 2
* Картинка ![Описание](https://github.com/images/modules/search/mona-love.png)

```


## changelog-init

Инициализация нового файла CHANGELOG.md для проекта.

### Параметры команды

- **-file** Исходный файл CHANGELOG.md в формате MarkDown из которого необходимо получить описание (обязательный).
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

### Как инициализируется файл Changelog?

```markdown
# Changelog

Все изменения по проекту.

## [1.0.0.0] - 2023-06-08

### Внимание!

* Важная заметка 1 **жирный** *курсив*
* Важная заметка 2 ~~Зачеркнутый~~

### Добавлено

* Добавлено дело 1 ***жирный курсив***
* Добавлено дело 2 `выделенный`
* Картинка ![Описание](https://github.com/images/modules/search/mona-love.png)

### Изменено

* Изменение 1 __снова жиный__ _снова курсив_
* Изменение 2

### Исправлено

* Исправление ошибки
```


## checkconfig

Выполнить проверку синтаксиса конфигурации 1С встроенными средствами.

### Параметры команды

- **-ibconnection** Строка подключения к ИБ (/FfilePath или /SserverPath) (обязательно)
	Например, для файловых баз -ibconnection /FC:\base1 или -ibconnection /Fbase1
	Или для серверных баз -ibconnection /Sservername\basename.
- **-ib-user** Пользователь ИБ.
- **-ib-pwd** Пароль пользователя ИБ.
- **-v8version** Версия платформы 1С (необязательно). Примеры:
	8.3
	8.3.22
	8.3.22.3456.
- **-uccode** Ключ разрешения запуска (необязательно).
- **-ordinaryapp** Запуск толстого клиента (1 = толстый, 0 = тонкий клиент, -1 = без указания клиента). 
	По умолчанию используется значение 0 (тонкий клиент). 
	Значение -1 может применяться в случаях, когда нужно прочитать лог работы 1С в режиме Предприятие в управляемом интерфейсе..
- **-language** Код языка запуска платформы (необязательно).
- **-locale** Код локализации сеанса платформы (необязательно).
- **-ThinClient** Тонкий клиент.
- **-WebClient** Веб-клиент.
- **-Server** Сервер.
- **-ExternalConnection** Внешнее соединение.
- **-ThickClientOrdinaryApplication** Толстый клиент об. прил..
- **-ThickClientManagedApplication** Толстый клиент упр. прил.
- **-ThickClientServerManagedApplication** Толстый клиент упр. прил. клиент-сервер.
- **-ThickClientServerOrdinaryApplication** Толстый клиент об. прил. клиент-сервер.
- **-ExternalConnectionServer** Внешнее соединение клиент-сервер.
- **-ConfigLogIntegrity** Логическая целостность конфигурации.
- **-IncorrectReferences** Поиск некорректных ссылок.
- **-DistributiveModules** Поставка без исходных текстов.
- **-EmptyHandlers** Поиск пустых обработчиков.
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

## checksum

Выводит в консоль контрольную сумма файла или директории в формате MD5.

### Параметры команды

- **-file** Исходный файл или директория (обязательный).
- **-mask** Маска файлов для контрольной суммы, используется если указана директория.
Если параметр не задан для директории, то контрольная сумма будет сформирована по всем файлам (необязательный).
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

### Зачем нужна эта команда?

Контрольая сумма по файлу/директории позволяет получить строку, которая будет не изменна для файлов, пока они не изменятся.
Это может пригодится для того, чтобы понять надо ли собирать по новой проект или нет (изменялись ли файлы в папке или нет).

Например, в pipeline мы можем сохранять собранный проект 1C в хранилище сборок вида:

```ini
06ead29bfa5dfa3d4cce226854d412ea=С:\Builder\06ead29bfa5dfa3d4cce226854d412ea\config.cf
```

Далее, в начале сборки pipeline смотрим надо ли собирать проект из исходников EDT? Для этого:

1. Считаем по директории контрольную сумму
2. Смотрим есть ли в хранилище сборок база с такой контрольной суммой
2.1. Если *Да* - берем эту базу из хранилища сборок и не собираем из проект EDT конфигурацию.
2.2. Если *Нет* - собираем проект EDT в конфигурацию cf, сохрнаяем ее в хранилище сборок, где присваиваем сборке контрольную сумму.
3. При повторных сборках когда не меняется конфигурация, мы будем экономить время на сборку.

> **Внимание!** Следует с осторожностью относится к директориям где находится очень много больших файлов. В таких каталогах контрольная сумма будет рассчитываться не быстро. Имейте это ввиду.


## createibfile

Создание файловой информационной базы 1C в каталоге.

### Параметры команды

- **Действие** file|server.
- **-ibconnection** Строка подключения к ИБ (/FfilePath или /SserverPath) (обязательно)
	Например, для файловых баз -ibconnection /FC:\base1 или -ibconnection /Fbase1
	Или для серверных баз -ibconnection /Sservername\basename.
- **-addinlist** Имя, под которым база добавляется в список.
Если этот параметр не указан, база добавлена в список не будет (необязательно).
- **-template** Путь к шаблону для создания информационной базы (*.cf; *.dt).
Если шаблон не указан, то будет создана пустая ИБ (необязательно).
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

## createibserver

Создание серверной информационной базы на сервере 1С.

### Параметры команды

- **Действие** file|server.
- **-ibconnection** Строка подключения к ИБ (/FfilePath или /SserverPath) (обязательно)
	Например, для файловых баз -ibconnection /FC:\base1 или -ibconnection /Fbase1
	Или для серверных баз -ibconnection /Sservername\basename.
- **-cluster-user** Администратор кластера (необязательно).
- **-cluster-pwd** Пароль администратора кластера (необязательно).
- **-addinlist** Имя, под которым база добавляется в список.
Если этот параметр не указан, база добавлена в список не будет (необязательно).
- **-template** Путь к шаблону для создания информационной базы (*.cf; *.dt).
Если шаблон не указан, то будет создана пустая ИБ (необязательно).
- **-db-srvr** Адрес сервера СУБД.
- **-sql-offs** Смещение дат на сервере MS SQL (0; 2000 <по умолчанию>).
- **-createdb** Создавать базу данных в случае отсутствия.
- **-allowschjob** Разрешить регламентные задания.
- **-allowlicdstr** Разрешить выдачу лицензий сервером 1С.
- **-dbms** Тип сервера СУБД (MSSQLServer <по умолчанию>; PostgreSQL; IBMDB2; OracleDatabase).
- **-db-user** Пользователь информационной базы (необязательно).
- **-db-pwd** Пароль пользователя информационной базы (необязательно).
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

## help

Вывод справки по параметрам.

### Параметры команды

- **Команда** .
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

## obfuscation

Обфускация (запутывание) кода файла общего модуля на языке 1С.

### Параметры команды

- **-file** Исходный файл, который необходимо обфусцировать.
- **-outfile** Куда сохранить обфусцированный файл. Если не задан, то исходный файл будет заменен обфусцированным.
- **-APIKey** API ключ, который можно найти на сайте сервиса. Пример: 23412341A4..12FDA.
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

### Зачем нужна обфускация в 1С?

**Обфускация** или запутывание кода — приведение исходного кода или исполняемого кода программы к виду, сохраняющему её функциональность, но затрудняющему анализ, понимание алгоритмов работы и модификацию при декомпиляции.

Обфускация используется для защиты конфигураций 1С, в частности общих модулей.

Приведем наглядный пример. Пусть у нас есть модуль, который содержит функцию возвращающуу массив простых чисел:

```bsl
// Возвращает массив простых чисел от 1 до максимального.
//
// Параметры:
//	МаксимальноеЧисло - Число - до этого числа будет строится массив.
//
// Возвращаемой значение:
//	Массив - массив простых чисел.
//
Функция МассивПростыхЧисел(Знач МаксимальноеЧисло) Экспорт
	
	Результат = Новый Массив;
	Для ПроверяемоеЧисло = 1 По МаксимальноеЧисло Цикл
							
		ВерхняяГраницаПроверки = ПроверяемоеЧисло - 1;
		ЭтоПростоеЧисло = Истина;
		Для Индекс = 2 По ВерхняяГраницаПроверки Цикл
			Если ПроверяемоеЧисло % Индекс = 0 Тогда
				ЭтоПростоеЧисло = Ложь;
				Прервать;
			КонецЕсли;
		КонецЦикла;
		
		Если ЭтоПростоеЧисло Тогда
			Результат.Добавить(ПроверяемоеЧисло);
		КонецЕсли;
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции
```

Выполняем команду в консоли (в папке src)

```cmd
oscript cicd.os obfuscation -file c:\Temp\ПростыеЧисла.bsl -outfile c:\Temp\ПростыеЧислаОбфусцированный.bsl -APIKey 4447C4CB6DDFF7597277904444F8F024945DB382993D1A9403F27F4760B19B719662424EE1AAA34A85C0444D828CB8F54433F82BC8448185F915E9B8768DEBDF
```

И получаем обфусцированный файл:

```bsl
function массивпростыхчисел(val a)export var ___a; ~0:; _0=1; _0=-_0; _1=1; _0=_0>=_1; if _0=false then goto ~IL_0 endif; goto ~2; ~IL_0:; goto ~1; ~1:; goto ~3; ~2:; ~3:; _0=new массив; a_=_0; goto ~5; ~4:; _0=new структура; a_=_0; goto ~5; ~5:; _0=1; a__=_0; _0=a; _e96099e2_1fdd_449a_af14_28f4abb97b25=_0; goto ~IL_2; ~IL_3:; ~6:; _0=1; _1=0; _0=_0<=_1; if _0=false then goto ~IL_5 endif; goto ~7; ~IL_5:; goto ~10; ~7:; ~8:; _0=a__; _1=1; _0=_0-_1; a___=_0; goto ~11; ~9:; goto ~11; ~10:; goto ~8; ~11:; ~12:; _0=0; ___a=_0; goto ~13; ~13:; _0=истина; _a=_0; goto ~15;
~14:; goto ~15; ~15:; _0=2; __a=_0; _0=a___; _9f91b140_1943_4368_8052_23db0ec59cb7=_0; goto ~IL_7; ~IL_8:; ~16:; _0=1; ___a=_0; goto ~18; ~17:; goto ~19; ~18:; _0=a__; _1=__a; _0=_0%_1; _1=0; _0=_0=_1; if _0=false then goto ~IL_10 endif; goto ~20; ~IL_10:; goto ~19; ~19:; goto ~31; ~20:; ~21:; _0=1; _1=0; _0=_0>_1; if _0=false then goto ~IL_11 endif; goto ~23; ~IL_11:; goto ~24; ~22:; _0=ложь; _a=_0; goto ~26; ~23:; goto ~22; ~24:; ~25:; goto ~26; ~26:; ~27:; _0=1; ___a=_0; goto ~28; ~28:; goto ~IL_6; goto ~30; ~29:; goto ~30; ~30:; goto ~31; ~31:; ~IL_9:; _0=__a; _1=1;
_0=_0+_1; __a=_0; ~IL_7: _0=__a; _1=_9f91b140_1943_4368_8052_23db0ec59cb7; if _0<=_1 then goto ~IL_8 endif; ~IL_6:; ~32:; _0=0; ___a=_0; goto ~33; ~33:; _0=_a; if _0=false then goto ~IL_12 endif; goto ~36; ~IL_12:; goto ~35; ~34:; goto ~35; ~35:; goto ~41; ~36:; ~37:; _0=1; _0=-_0; ___a=_0; goto ~39; ~38:; goto ~40; ~39:; a_.добавить(a__); goto ~40; ~40:; goto ~41; ~41:; ~IL_4:; _0=a__; _1=1; _0=_0+_1; a__=_0; ~IL_2: _0=a__; _1=_e96099e2_1fdd_449a_af14_28f4abb97b25; if _0<=_1 then goto ~IL_3 endif; ~IL_1:; ~42:; _0=1; _1=1; _1=-_1; _0=_0<=_1; if _0=false then goto ~IL_13 endif;
goto ~44; ~IL_13:; goto ~43; ~43:; goto ~46; ~44:; ~45:; goto ~47; ~46:; _0=a_; return _0; goto ~47; ~47:; endfunction 
```

Вставив обфусцированный модуль вместо старого модуля получим точно такую же работающую функцию.


## version

Версия приложения.

### Параметры команды

- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

## zip-add

Создать zip-архив.

### Параметры команды

- **-file** Полное имя файла создаваемого zip-архива (обязательный).
- **-path** Файлы и папки, включаемые в архив. Можно использовать разделитель ";" или "|" и маски файлов (обязательный).
 Примеры:
   "C:\Path\File1.txt|C:\Path\Folder"
   "C:\Path\*.txt;C:\Path\Folder\*.*"
   "C:\Path\Folder".
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

## zip-extract

Распаковать zip-архив в директорию.

### Параметры команды

- **-file** Полное имя zip-архива (обязательный).
- **-path** Директория куда необходимо распаковать архив (обязательный).
- **-settings** Путь к файлу настроек CI/CD в формате json. По умолчанию имя файла "env.json"  (необязательно).
- **-logfile** Вывод отладочных файлов в указанный лог-файл (необязательно).

