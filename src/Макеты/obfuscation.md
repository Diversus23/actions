#### Зачем нужна обфускация в 1С?

**Обфускация** или запутывание кода — приведение исходного кода или исполняемого кода программы к виду, сохраняющему её функциональность, но затрудняющему анализ, понимание алгоритмов работы и модификацию при декомпиляции.

Обфускация используется для защиты конфигураций 1С, в частности общих модулей.

Приведем наглядный пример. Пусть у нас есть модуль, который содержит функцию возвращающуу массив простых чисел:

```bsl
// Возвращает массив простых чисел от 1 до максимального.
//
// Параметры:
//	МаксимальноеЧисло - Число - до этого числа будет строится массив.
//
// Возвращаемой значение:
//	Массив - массив простых чисел.
//
Функция МассивПростыхЧисел(Знач МаксимальноеЧисло) Экспорт
	
	Результат = Новый Массив;
	Для ПроверяемоеЧисло = 1 По МаксимальноеЧисло Цикл
							
		ВерхняяГраницаПроверки = ПроверяемоеЧисло - 1;
		ЭтоПростоеЧисло = Истина;
		Для Индекс = 2 По ВерхняяГраницаПроверки Цикл
			Если ПроверяемоеЧисло % Индекс = 0 Тогда
				ЭтоПростоеЧисло = Ложь;
				Прервать;
			КонецЕсли;
		КонецЦикла;
		
		Если ЭтоПростоеЧисло Тогда
			Результат.Добавить(ПроверяемоеЧисло);
		КонецЕсли;
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции
```

Выполняем команду в консоли (в папке src)

```cmd
oscript actions.os obfuscation -file c:\Temp\ПростыеЧисла.bsl -outfile c:\Temp\ПростыеЧислаОбфусцированный.bsl -APIKey 4447C4CB6DDFF7597277904444F8F024945DB382993D1A9403F27F4760B19B719662424EE1AAA34A85C0444D828CB8F54433F82BC8448185F915E9B8768DEBDF
```

И получаем обфусцированный файл:

```bsl
function массивпростыхчисел(val a)export var ___a; ~0:; _0=1; _0=-_0; _1=1; _0=_0>=_1; if _0=false then goto ~IL_0 endif; goto ~2; ~IL_0:; goto ~1; ~1:; goto ~3; ~2:; ~3:; _0=new массив; a_=_0; goto ~5; ~4:; _0=new структура; a_=_0; goto ~5; ~5:; _0=1; a__=_0; _0=a; _e96099e2_1fdd_449a_af14_28f4abb97b25=_0; goto ~IL_2; ~IL_3:; ~6:; _0=1; _1=0; _0=_0<=_1; if _0=false then goto ~IL_5 endif; goto ~7; ~IL_5:; goto ~10; ~7:; ~8:; _0=a__; _1=1; _0=_0-_1; a___=_0; goto ~11; ~9:; goto ~11; ~10:; goto ~8; ~11:; ~12:; _0=0; ___a=_0; goto ~13; ~13:; _0=истина; _a=_0; goto ~15;
~14:; goto ~15; ~15:; _0=2; __a=_0; _0=a___; _9f91b140_1943_4368_8052_23db0ec59cb7=_0; goto ~IL_7; ~IL_8:; ~16:; _0=1; ___a=_0; goto ~18; ~17:; goto ~19; ~18:; _0=a__; _1=__a; _0=_0%_1; _1=0; _0=_0=_1; if _0=false then goto ~IL_10 endif; goto ~20; ~IL_10:; goto ~19; ~19:; goto ~31; ~20:; ~21:; _0=1; _1=0; _0=_0>_1; if _0=false then goto ~IL_11 endif; goto ~23; ~IL_11:; goto ~24; ~22:; _0=ложь; _a=_0; goto ~26; ~23:; goto ~22; ~24:; ~25:; goto ~26; ~26:; ~27:; _0=1; ___a=_0; goto ~28; ~28:; goto ~IL_6; goto ~30; ~29:; goto ~30; ~30:; goto ~31; ~31:; ~IL_9:; _0=__a; _1=1;
_0=_0+_1; __a=_0; ~IL_7: _0=__a; _1=_9f91b140_1943_4368_8052_23db0ec59cb7; if _0<=_1 then goto ~IL_8 endif; ~IL_6:; ~32:; _0=0; ___a=_0; goto ~33; ~33:; _0=_a; if _0=false then goto ~IL_12 endif; goto ~36; ~IL_12:; goto ~35; ~34:; goto ~35; ~35:; goto ~41; ~36:; ~37:; _0=1; _0=-_0; ___a=_0; goto ~39; ~38:; goto ~40; ~39:; a_.добавить(a__); goto ~40; ~40:; goto ~41; ~41:; ~IL_4:; _0=a__; _1=1; _0=_0+_1; a__=_0; ~IL_2: _0=a__; _1=_e96099e2_1fdd_449a_af14_28f4abb97b25; if _0<=_1 then goto ~IL_3 endif; ~IL_1:; ~42:; _0=1; _1=1; _1=-_1; _0=_0<=_1; if _0=false then goto ~IL_13 endif;
goto ~44; ~IL_13:; goto ~43; ~43:; goto ~46; ~44:; ~45:; goto ~47; ~46:; _0=a_; return _0; goto ~47; ~47:; endfunction 
```

Вставив обфусцированный модуль вместо старого модуля получим точно такую же работающую функцию.
